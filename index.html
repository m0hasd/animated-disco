<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamm - Sahatna Space - Having a Baby</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        tamm: {
                            bg: '#121212',
                            card: '#1E1E1E',
                            primary: '#00C2CB', 
                            primaryDark: '#00A0A8',
                            darkBlue: '#0A2540',
                            gradientStart: '#00619E',
                            gradientEnd: '#009FBD',
                            gold: '#D4AF37',
                            ivfPurple: '#8B5CF6',
                            postnatalPink: '#EC4899',
                            wellChildBlue: '#3B82F6',
                            successGreen: '#10B981',
                            warningYellow: '#F59E0B',
                            dangerRed: '#EF4444'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #121212;
            color: white;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .sah-gradient { background: linear-gradient(135deg, #004e92 0%, #00C2CB 100%); }
        .ivf-gradient { background: linear-gradient(135deg, #4c1d95 0%, #8B5CF6 100%); }
        .postnatal-gradient { background: linear-gradient(135deg, #be185d 0%, #EC4899 100%); }
        .wellchild-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #3B82F6 100%); }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Toggle Switch Styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #00C2CB;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #00C2CB;
        }

        /* Timeline Connector */
        .step-connector {
            position: absolute;
            top: 30%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #374151;
            z-index: 0;
            transform: translateY(-50%);
        }
        
        /* Modal Overlay */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="antialiased min-h-screen relative overflow-hidden">

    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto h-screen bg-[#121212] relative flex flex-col shadow-2xl overflow-hidden border-x border-gray-800">
        
        <!-- HEADER (Dynamic) -->
        <header class="p-4 pt-12 flex justify-between items-center z-20 absolute top-0 w-full bg-gradient-to-b from-black/80 to-transparent">
            <button id="backBtn" onclick="goBack()" class="w-10 h-10 rounded-full bg-gray-800/50 flex items-center justify-center hidden backdrop-blur-md hover:bg-gray-700 transition">
                <i class="fas fa-chevron-left text-white"></i>
            </button>
            <div class="flex-1"></div>
            <!-- Settings/Profile Icon placeholder -->
            <div onclick="navigateTo('screen-profile')" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center border border-gray-700 relative cursor-pointer active:scale-95 transition">
                 <i class="fas fa-user text-xs text-gray-400"></i>
                 <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-[#121212]"></div>
            </div>
        </header>

        <!-- MAIN CONTENT AREA -->
        <main id="mainContent" class="flex-1 overflow-y-auto no-scrollbar pb-24 relative">
            
            <!-- SCREEN 1: SAHATNA HOME -->
            <div id="screen-home" class="animate-fade-in">
                <!-- Hero Section -->
                <div class="sah-gradient pt-28 pb-10 px-6 rounded-b-[40px] relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -mr-20 -mt-20 blur-3xl"></div>
                    
                    <h2 class="text-sm font-medium text-blue-100 mb-1 opacity-80">Sahatna Space</h2>
                    <h1 class="text-3xl font-bold text-white mb-6">My Wellness</h1>
                    
                    <!-- Action Card -->
                    <div class="bg-white/10 backdrop-blur-md border border-white/20 p-5 rounded-2xl flex items-center justify-between mb-2 cursor-pointer active:scale-95 transition" onclick="showToast('Health Status: Optimal')">
                        <div>
                            <p class="text-xs text-blue-100 mb-1">Status</p>
                            <h3 class="font-semibold text-lg">All Good</h3>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-tamm-primary flex items-center justify-center text-black">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                    </div>
                </div>

                <!-- Services Grid -->
                <div class="px-5 mt-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <span class="w-1 h-6 bg-tamm-primary rounded-full mr-3"></span>
                        Key Journeys
                    </h3>
                    
                    <!-- The Trigger Journey -->
                    <div onclick="navigateTo('screen-onboarding')" class="bg-tamm-card active:scale-95 transition-transform p-4 rounded-2xl border border-gray-800 mb-4 flex items-center cursor-pointer relative overflow-hidden group">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-tamm-primary opacity-5 rounded-full blur-2xl group-hover:opacity-10 transition"></div>
                        <div class="w-12 h-12 rounded-xl bg-gray-800 flex items-center justify-center mr-4 text-tamm-primary text-xl">
                            <i class="fas fa-baby-carriage"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white">Having a Baby</h4>
                            <p class="text-xs text-gray-400 mt-1">Guidance from planning to parenthood</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </div>

                    <div class="bg-tamm-card p-4 rounded-2xl border border-gray-800 mb-4 flex items-center opacity-60 active:scale-95 transition cursor-pointer" onclick="showToast('Prescriptions Module Coming Soon')">
                        <div class="w-12 h-12 rounded-xl bg-gray-800 flex items-center justify-center mr-4 text-purple-400 text-xl">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white">Prescriptions</h4>
                            <p class="text-xs text-gray-400 mt-1">Manage your medications</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </div>
                </div>
            </div>

            <!-- SCREEN 2: ONBOARDING / SELECT STAGE -->
            <div id="screen-onboarding" class="hidden animate-fade-in min-h-screen bg-black">
                <div class="pt-28 px-6">
                    <h1 class="text-2xl font-bold mb-2">Welcome to your<br>Maternity Journey</h1>
                    <p class="text-gray-400 text-sm mb-8">To provide tailored content, please tell us where you are in your journey.</p>

                    <div class="space-y-4">
                        <!-- Pre-conception / IVF -->
                        <button onclick="setStage('preconception')" class="w-full text-left p-5 rounded-2xl bg-gray-900 border border-gray-800 hover:border-tamm-primary transition flex items-center group active:scale-[0.98]">
                            <div class="w-10 h-10 rounded-full bg-purple-900/30 text-purple-400 flex items-center justify-center mr-4">
                                <i class="fas fa-vial"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-white group-hover:text-tamm-primary">IVF & Planning</h3>
                                <p class="text-xs text-gray-500">Fertility treatments & ovulation tracking</p>
                            </div>
                        </button>

                        <!-- Pregnancy -->
                        <button onclick="setStage('pregnancy')" class="w-full text-left p-5 rounded-2xl bg-gray-900 border border-tamm-primary/50 shadow-[0_0_20px_rgba(0,194,203,0.1)] transition flex items-center relative overflow-hidden active:scale-[0.98]">
                            <div class="w-10 h-10 rounded-full bg-tamm-primary/20 text-tamm-primary flex items-center justify-center mr-4">
                                <i class="fas fa-baby"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-white">I'm Pregnant</h3>
                                <p class="text-xs text-gray-400">Positive test or existing pregnancy</p>
                            </div>
                            <div class="absolute top-2 right-2 px-2 py-0.5 bg-tamm-primary text-black text-[10px] font-bold rounded-full">RECOMMENDED</div>
                        </button>

                        <!-- Birth -->
                        <button onclick="setStage('birth')" class="w-full text-left p-5 rounded-2xl bg-gray-900 border border-gray-800 hover:border-tamm-primary transition flex items-center group active:scale-[0.98]">
                            <div class="w-10 h-10 rounded-full bg-pink-900/30 text-pink-400 flex items-center justify-center mr-4">
                                <i class="fas fa-hospital-user"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-white group-hover:text-tamm-primary">Birth & Labor</h3>
                                <p class="text-xs text-gray-500">Preparing for delivery</p>
                            </div>
                        </button>

                        <!-- Post-birth -->
                        <button onclick="setStage('postbirth')" class="w-full text-left p-5 rounded-2xl bg-gray-900 border border-gray-800 hover:border-tamm-primary transition flex items-center group active:scale-[0.98]">
                            <div class="w-10 h-10 rounded-full bg-blue-900/30 text-blue-400 flex items-center justify-center mr-4">
                                <i class="fas fa-baby-carriage"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-white group-hover:text-tamm-primary">Post-birth Care</h3>
                                <p class="text-xs text-gray-500">Recovery & Newborn checks (4-Check Program)</p>
                            </div>
                        </button>

                        <!-- Well-Child -->
                        <button onclick="setStage('wellchild')" class="w-full text-left p-5 rounded-2xl bg-gray-900 border border-gray-800 hover:border-tamm-primary transition flex items-center group active:scale-[0.98]">
                            <div class="w-10 h-10 rounded-full bg-green-900/30 text-green-400 flex items-center justify-center mr-4">
                                <i class="fas fa-child"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-white group-hover:text-tamm-primary">Child Growth</h3>
                                <p class="text-xs text-gray-500">Milestones, Vaccines & Dental (1mo - 6yrs)</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- SCREEN 3: MAIN DASHBOARD -->
            <div id="screen-dashboard" class="hidden animate-fade-in bg-[#121212]">
                
                <!-- Sticky Header Segment with User Toggle -->
                <div class="pt-24 pb-4 px-5 bg-gradient-to-b from-[#121212] to-[#121212] border-b border-gray-800 sticky top-0 z-10">
                    
                    <!-- USER TOGGLE -->
                    <div class="flex justify-center mb-4">
                        <div class="bg-gray-800 p-1 rounded-lg flex text-xs font-medium w-full max-w-[240px]">
                            <button id="toggle-citizen" onclick="toggleUserType('citizen')" class="flex-1 py-1.5 rounded-md bg-gray-700 text-white shadow transition-all duration-300">
                                Citizen
                            </button>
                            <button id="toggle-resident" onclick="toggleUserType('resident')" class="flex-1 py-1.5 rounded-md text-gray-400 hover:text-white transition-all duration-300">
                                Resident
                            </button>
                        </div>
                    </div>

                    <!-- RISK TOGGLE (Post-birth) -->
                    <div id="risk-toggle-container" class="hidden flex justify-center mb-4 animate-fade-in">
                        <div class="bg-gray-800/50 border border-gray-700 p-1 rounded-lg flex items-center gap-2 px-3">
                            <span class="text-[10px] text-gray-400 uppercase tracking-wider">Risk Profile:</span>
                            <div class="flex text-xs font-medium">
                                <button id="risk-std" onclick="toggleRisk('low')" class="px-3 py-1 rounded-md bg-green-900/30 text-green-400 border border-green-900 transition-all">Standard</button>
                                <button id="risk-high" onclick="toggleRisk('high')" class="px-3 py-1 rounded-md text-gray-500 hover:text-red-400 transition-all">High Risk</button>
                            </div>
                        </div>
                    </div>

                    <!-- CHILD AGE SELECTOR (Well-Child) -->
                    <div id="child-age-selector" class="hidden overflow-x-auto no-scrollbar mb-4 animate-fade-in pb-2">
                        <div class="flex gap-2">
                            <button onclick="setChildAge(1)" class="age-btn active px-3 py-1 rounded-full bg-tamm-wellChildBlue text-white text-xs border border-blue-500 whitespace-nowrap">1 Mo</button>
                            <button onclick="setChildAge(6)" class="age-btn px-3 py-1 rounded-full bg-gray-800 text-gray-400 text-xs border border-gray-700 whitespace-nowrap">6 Mo</button>
                            <button onclick="setChildAge(12)" class="age-btn px-3 py-1 rounded-full bg-gray-800 text-gray-400 text-xs border border-gray-700 whitespace-nowrap">12 Mo</button>
                            <button onclick="setChildAge(18)" class="age-btn px-3 py-1 rounded-full bg-gray-800 text-gray-400 text-xs border border-gray-700 whitespace-nowrap">18 Mo</button>
                            <button onclick="setChildAge(36)" class="age-btn px-3 py-1 rounded-full bg-gray-800 text-gray-400 text-xs border border-gray-700 whitespace-nowrap">3 Yrs</button>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mb-3">
                        <div>
                            <p class="text-xs text-gray-400">Current Stage</p>
                            <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('screen-onboarding')">
                                <h2 id="dashboard-title" class="text-xl font-bold text-white">Pregnancy</h2>
                                <i class="fas fa-chevron-down text-xs text-tamm-primary"></i>
                            </div>
                        </div>
                        <div class="w-10 h-10 rounded-full border border-gray-700 flex items-center justify-center cursor-pointer hover:bg-gray-800" onclick="showToast('No new notifications')">
                            <div class="relative">
                                <i class="fas fa-bell text-gray-400"></i>
                                <div id="notif-dot" class="hidden absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="flex justify-between items-center px-1 mb-2">
                        <div id="prog-1" class="h-1 w-[22%] rounded-full bg-gray-700 transition-colors duration-500"></div>
                        <div id="prog-2" class="h-1 w-[22%] rounded-full bg-gray-700 transition-colors duration-500"></div>
                        <div id="prog-3" class="h-1 w-[22%] rounded-full bg-gray-700 transition-colors duration-500"></div>
                        <div id="prog-4" class="h-1 w-[22%] rounded-full bg-gray-700 transition-colors duration-500"></div>
                    </div>
                </div>

                <!-- Dynamic Content Container -->
                <div class="p-5 pb-32">
                    
                    <!-- HERO STATUS CARD -->
                    <div id="hero-card" class="rounded-3xl p-6 mb-8 relative overflow-hidden border border-gray-700 shadow-lg active:scale-[0.99] transition-transform duration-300">
                        <!-- Content injected via JS -->
                    </div>
                    
                    <!-- POSTNATAL TIMELINE (Interactive) -->
                    <div id="postnatal-timeline" class="hidden mb-8 animate-fade-in">
                        <div class="flex justify-between items-end mb-4">
                            <h3 class="text-sm font-bold text-gray-300">4-Check Program</h3>
                            <span id="risk-label" class="text-[9px] bg-green-900/50 text-green-400 px-2 py-0.5 rounded border border-green-800">Standard Pathway</span>
                        </div>
                        <div class="relative flex justify-between items-start px-1 h-16" id="postnatal-steps">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- IVF TIMELINE (Interactive) -->
                    <div id="ivf-timeline" class="hidden mb-8">
                        <h3 class="text-sm font-bold mb-4 text-gray-300 flex justify-between items-center">
                            Cycle Pathway
                            <span class="text-[10px] bg-tamm-ivfPurple text-white px-2 py-0.5 rounded-full">Day 4</span>
                        </h3>
                        <div class="relative flex justify-between items-center px-2" id="ivf-steps">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- MILESTONE TRACKER -->
                    <div id="milestone-tracker" class="hidden mb-8 animate-fade-in">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-sm font-bold text-gray-300">Developmental Milestones</h3>
                            <span class="text-[9px] text-gray-500">Appendix 6</span>
                        </div>
                        <div class="bg-gray-900 border border-gray-800 rounded-2xl p-4">
                            <div class="space-y-4" id="milestone-list">
                                <!-- Populated via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- CARE TEAM -->
                    <div id="care-team" class="hidden mb-8">
                        <h3 class="text-sm font-bold mb-3 text-gray-300">My Care Team</h3>
                        <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                            <!-- Injected Static Content for prototype -->
                            <div class="flex-shrink-0 flex items-center bg-gray-900 border border-gray-800 p-2 pr-4 rounded-full cursor-pointer hover:bg-gray-800 transition" onclick="showToast('Contacting Sarah...')">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-8 h-8 rounded-full border border-gray-600 mr-2">
                                <div>
                                    <p class="text-[10px] text-gray-400">Coordinator</p>
                                    <p class="text-xs font-bold">Sarah</p>
                                </div>
                                <div class="w-6 h-6 ml-3 bg-green-500/20 text-green-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-comment text-[10px]"></i>
                                </div>
                            </div>
                            <div class="flex-shrink-0 flex items-center bg-gray-900 border border-gray-800 p-2 pr-4 rounded-full">
                                <img src="https://randomuser.me/api/portraits/women/65.jpg" class="w-8 h-8 rounded-full border border-gray-600 mr-2">
                                <div>
                                    <p id="clinician-role" class="text-[10px] text-gray-400">Home Facilitator</p>
                                    <p id="clinician-name" class="text-xs font-bold">Nurse Layla</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NEWBORN SCREENING CARD -->
                    <div id="newborn-screening-card" class="hidden mb-8 animate-fade-in cursor-pointer active:scale-[0.98] transition-transform" onclick="navigateTo('screen-newborn-results')">
                        <div class="p-[1px] rounded-2xl bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500">
                            <div class="bg-gray-900 rounded-2xl p-4 relative overflow-hidden">
                                <div class="absolute right-0 top-0 w-24 h-24 bg-blue-500 opacity-10 rounded-bl-full blur-xl"></div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-blue-900/50 border border-blue-500/30 flex items-center justify-center text-blue-400">
                                            <i class="fas fa-microscope"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-white text-sm">Newborn Screening</h4>
                                            <p class="text-xs text-gray-400">4 Mandatory Tests • <span class="text-yellow-500">Action Required</span></p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-500 text-xs"></i>
                                </div>
                                <div class="flex gap-1 mt-3">
                                    <div class="h-1 flex-1 bg-green-500 rounded-full"></div>
                                    <div class="h-1 flex-1 bg-green-500 rounded-full"></div>
                                    <div class="h-1 flex-1 bg-red-500 rounded-full animate-pulse"></div>
                                    <div class="h-1 flex-1 bg-gray-700 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DIGITAL TOOLS -->
                    <div id="digital-tools" class="grid grid-cols-2 gap-3 mb-8">
                        <!-- Injected via JS -->
                    </div>

                    <!-- SERVICES SECTION -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                            <div class="w-1 h-5 bg-tamm-primary rounded-full"></div>
                            Journey Services
                        </h3>
                        <div id="services-list" class="space-y-3">
                            <!-- Services injected via JS -->
                        </div>
                    </div>

                    <!-- COMMUNITY -->
                    <div id="community-card" class="hidden mb-8 bg-gray-900 border border-gray-800 rounded-2xl p-4 relative overflow-hidden cursor-pointer active:scale-[0.98] transition" onclick="showToast('Joined Community: New Moms AD')">
                        <div class="absolute right-0 bottom-0 w-24 h-24 bg-purple-500 opacity-5 rounded-full blur-xl"></div>
                        <div class="flex items-start justify-between">
                            <div>
                                <h4 class="text-sm font-bold text-white mb-1"><i class="fas fa-users text-purple-400 mr-2"></i>Anonymous Community</h4>
                                <p class="text-xs text-gray-400 w-3/4">Connect with others on the same journey in a safe, judgment-free space.</p>
                            </div>
                            <button class="px-3 py-1 bg-gray-800 rounded-full text-xs border border-gray-700">Join</button>
                        </div>
                    </div>

                    <!-- EDUCATIONAL CONTENT -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">Recommended For You</h3>
                        <span class="text-xs text-tamm-primary">See All</span>
                    </div>

                    <!-- Feed -->
                    <div id="content-feed" class="flex overflow-x-auto gap-4 pb-4 no-scrollbar -mx-5 px-5">
                        <!-- Content injected via JS -->
                    </div>

                </div>
            </div>

            <!-- SCREEN 4: SERVICE DETAILS -->
            <div id="screen-service-details" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="pt-28 px-6">
                    <div id="sd-icon-container" class="w-20 h-20 rounded-3xl bg-gray-800 flex items-center justify-center mb-6 shadow-2xl border border-gray-700">
                        <i id="sd-icon" class="fas fa-gift text-4xl text-white"></i>
                    </div>
                    <h1 id="sd-title" class="text-3xl font-bold text-white mb-2 leading-tight">Service Title</h1>
                    <p id="sd-subtitle" class="text-gray-400 text-sm mb-8 leading-relaxed">Service description goes here.</p>
                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-900/50 p-4 rounded-2xl border border-gray-800">
                            <p class="text-xs text-gray-500 mb-1">Processing Time</p>
                            <p class="font-semibold text-white">1-3 Days</p>
                        </div>
                        <div class="bg-gray-900/50 p-4 rounded-2xl border border-gray-800">
                            <p class="text-xs text-gray-500 mb-1">Service Fee</p>
                            <p class="font-semibold text-white">Free</p>
                        </div>
                    </div>
                    <h3 class="text-lg font-bold mb-4">Required Documents</h3>
                    <div class="space-y-3 mb-8">
                        <div class="flex items-center p-3 bg-gray-900 rounded-xl border border-gray-800">
                            <i class="fas fa-id-card text-tamm-primary mr-3"></i>
                            <span class="text-sm">Emirates ID</span>
                            <i class="fas fa-check-circle text-green-500 ml-auto text-xs"></i>
                        </div>
                        <div class="flex items-center p-3 bg-gray-900 rounded-xl border border-gray-800">
                            <i class="fas fa-file-medical text-tamm-primary mr-3"></i>
                            <span class="text-sm">Medical Report</span>
                            <i class="fas fa-check-circle text-green-500 ml-auto text-xs"></i>
                        </div>
                    </div>
                </div>
                <div class="fixed bottom-0 w-full max-w-md bg-[#121212] border-t border-gray-800 p-6 z-30">
                    <button class="w-full bg-tamm-primary hover:bg-tamm-primaryDark text-black font-bold py-4 rounded-full transition shadow-[0_0_20px_rgba(0,194,203,0.3)]" onclick="showToast('Service Application Started')">
                        Start Service
                    </button>
                </div>
            </div>

            <!-- SCREEN 5: NEWBORN SCREENING -->
            <div id="screen-newborn-results" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="pt-28 px-6">
                    <h1 class="text-2xl font-bold text-white mb-2">Newborn Screening</h1>
                    <p class="text-gray-400 text-sm mb-6">Results for Baby Zayed • Age: 3 Days</p>
                    <div class="bg-red-900/20 border border-red-900/50 p-4 rounded-xl mb-6 flex items-start gap-3">
                        <i class="fas fa-exclamation-circle text-red-500 mt-1"></i>
                        <div>
                            <h4 class="text-red-400 font-bold text-sm">Action Required</h4>
                            <p class="text-xs text-red-200/70 mt-1">Immediate referral needed for CCHD screening result.</p>
                        </div>
                    </div>
                    <!-- Results List Static for Demo -->
                    <div class="space-y-4">
                        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                            <div class="flex justify-between items-start mb-2">
                                <div><h4 class="font-bold text-white text-sm">Physical Exam</h4></div>
                                <span class="bg-green-900/30 text-green-400 text-[10px] px-2 py-1 rounded">Normal</span>
                            </div>
                        </div>
                        <div class="bg-gray-900 border border-red-900/50 rounded-xl p-4 relative overflow-hidden">
                            <div class="absolute left-0 top-0 w-1 h-full bg-red-500"></div>
                            <div class="flex justify-between items-start mb-2">
                                <div><h4 class="font-bold text-white text-sm">CCHD Pulse Oximetry</h4></div>
                                <span class="bg-red-900/30 text-red-400 text-[10px] px-2 py-1 rounded font-bold">Fail</span>
                            </div>
                            <button class="w-full mt-2 bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 rounded-lg transition" onclick="showToast('Opening Referral REF-9928')">View Referral</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCREEN 6: ARTICLE READER (NEW) -->
            <div id="screen-article" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="relative h-64">
                    <img id="art-img" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#121212] to-transparent"></div>
                    <div class="absolute bottom-4 left-6">
                        <span id="art-cat" class="px-2 py-1 bg-tamm-primary text-black text-[10px] font-bold rounded mb-2 inline-block">Category</span>
                        <h1 id="art-title" class="text-2xl font-bold text-white leading-tight">Article Title</h1>
                    </div>
                </div>
                <div class="px-6 py-6">
                    <div class="flex items-center gap-3 mb-6">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-8 h-8 rounded-full">
                        <div>
                            <p class="text-xs font-bold text-white">Dr. Sarah Al Maktoum</p>
                            <p class="text-[10px] text-gray-500">Pediatric Specialist • 5 min read</p>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm leading-relaxed mb-4">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </p>
                    <p class="text-gray-300 text-sm leading-relaxed mb-4">
                        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                    </p>
                    <h3 class="text-lg font-bold text-white mt-6 mb-3">Key Takeaways</h3>
                    <ul class="list-disc list-inside text-gray-300 text-sm space-y-2 pl-2">
                        <li>Regular check-ups are essential.</li>
                        <li>Monitor growth milestones closely.</li>
                        <li>Nutrition plays a vital role.</li>
                    </ul>
                </div>
            </div>

            <!-- SCREEN 7: WALLET (NEW) -->
            <div id="screen-wallet" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="pt-28 px-6">
                    <h1 class="text-2xl font-bold text-white mb-6">My Wallet</h1>
                    
                    <!-- Emirates ID -->
                    <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-2xl p-5 mb-4 border border-gray-600 relative overflow-hidden shadow-lg transform transition hover:scale-[1.01]">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl"></div>
                        <div class="flex justify-between items-start mb-8">
                            <div class="flex items-center gap-2">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Emblem_of_the_United_Arab_Emirates.svg/1200px-Emblem_of_the_United_Arab_Emirates.svg.png" class="w-8 h-8 opacity-80">
                                <span class="text-xs font-bold text-gray-300">Emirates ID</span>
                            </div>
                            <img src="https://cdn-icons-png.flaticon.com/512/3580/3580382.png" class="w-8 h-8 filter invert opacity-50">
                        </div>
                        <p class="text-gray-400 text-[10px] uppercase tracking-widest mb-1">Name</p>
                        <p class="text-lg font-bold text-white mb-4">Fatima Al Mansouri</p>
                        <p class="text-gray-400 text-[10px] uppercase tracking-widest mb-1">ID Number</p>
                        <p class="text-sm font-mono text-white tracking-wider">784-1990-1234567-1</p>
                    </div>

                    <!-- Daman Card -->
                    <div class="bg-gradient-to-br from-blue-900 to-blue-800 rounded-2xl p-5 border border-blue-700 relative overflow-hidden shadow-lg transform transition hover:scale-[1.01]">
                        <div class="flex justify-between items-start mb-8">
                            <span class="text-xs font-bold text-white">DAMAN</span>
                            <span class="text-[10px] bg-white/20 px-2 py-1 rounded text-white">Active</span>
                        </div>
                        <p class="text-blue-200 text-[10px] uppercase tracking-widest mb-1">Policy Number</p>
                        <p class="text-lg font-bold text-white mb-4">DMN-9988-2211</p>
                        <div class="flex justify-between">
                            <div>
                                <p class="text-blue-200 text-[10px] uppercase tracking-widest mb-1">Network</p>
                                <p class="text-sm text-white">Thiqa</p>
                            </div>
                            <div>
                                <p class="text-blue-200 text-[10px] uppercase tracking-widest mb-1">Expiry</p>
                                <p class="text-sm text-white">12/2026</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCREEN 8: PROFILE (NEW) -->
            <div id="screen-profile" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="pt-28 px-6">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-20 h-20 rounded-full bg-gray-800 border-2 border-tamm-primary p-1">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-full h-full rounded-full object-cover">
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Fatima Al Mansouri</h1>
                            <p class="text-gray-400 text-sm">Citizen • Thiqa</p>
                        </div>
                    </div>

                    <h3 class="text-sm font-bold text-gray-500 mb-3 uppercase tracking-wider">Family Members</h3>
                    <div class="bg-gray-900 rounded-2xl p-1 mb-6">
                        <div class="flex items-center justify-between p-4 border-b border-gray-800">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-blue-900/50 text-blue-400 flex items-center justify-center font-bold">Z</div>
                                <div>
                                    <p class="text-sm font-bold text-white">Zayed</p>
                                    <p class="text-[10px] text-gray-400">Son • 3 Months</p>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
                        </div>
                        <div class="flex items-center justify-between p-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-pink-900/50 text-pink-400 flex items-center justify-center font-bold">M</div>
                                <div>
                                    <p class="text-sm font-bold text-white">Mariam</p>
                                    <p class="text-[10px] text-gray-400">Daughter • 4 Years</p>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
                        </div>
                    </div>

                    <h3 class="text-sm font-bold text-gray-500 mb-3 uppercase tracking-wider">Settings</h3>
                    <div class="bg-gray-900 rounded-2xl p-1">
                        <div class="flex items-center justify-between p-4 border-b border-gray-800 cursor-pointer hover:bg-gray-800 transition" onclick="showToast('Notifications Settings')">
                            <span class="text-sm text-white">Notifications</span>
                            <div class="w-10 h-5 bg-tamm-primary rounded-full relative"><div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                        </div>
                        <div class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-800 transition" onclick="showToast('Language Settings')">
                            <span class="text-sm text-white">Language</span>
                            <span class="text-xs text-gray-500">English</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TOOLS DASHBOARD (NEW - For Growth/Vaccine) -->
            <div id="screen-tools-dashboard" class="hidden animate-fade-in bg-[#121212] min-h-screen relative pb-32">
                <div class="pt-28 px-6">
                    <div id="tool-header" class="mb-6">
                        <h1 class="text-2xl font-bold text-white">Growth Chart</h1>
                        <p class="text-gray-400 text-sm">WHO Standards • Baby Zayed</p>
                    </div>
                    
                    <!-- Mock Chart Visualization -->
                    <div class="bg-gray-900 border border-gray-800 rounded-2xl p-6 mb-6">
                        <div class="flex justify-between items-end h-40 gap-2">
                            <div class="w-full bg-gray-800 rounded-t h-[20%] relative group"><div class="hidden group-hover:block absolute -top-8 left-0 bg-white text-black text-[10px] px-2 py-1 rounded">3kg</div></div>
                            <div class="w-full bg-gray-800 rounded-t h-[35%] relative group"><div class="hidden group-hover:block absolute -top-8 left-0 bg-white text-black text-[10px] px-2 py-1 rounded">4.5kg</div></div>
                            <div class="w-full bg-gray-800 rounded-t h-[50%] relative group"><div class="hidden group-hover:block absolute -top-8 left-0 bg-white text-black text-[10px] px-2 py-1 rounded">5.2kg</div></div>
                            <div class="w-full bg-tamm-primary rounded-t h-[65%] relative group"><div class="absolute -top-8 left-0 bg-white text-black text-[10px] px-2 py-1 rounded">6.1kg</div></div>
                            <div class="w-full bg-gray-800/30 rounded-t h-[75%] border-t border-dashed border-gray-600"></div>
                        </div>
                        <div class="flex justify-between text-[10px] text-gray-500 mt-2">
                            <span>Birth</span>
                            <span>1m</span>
                            <span>2m</span>
                            <span>3m</span>
                            <span>4m</span>
                        </div>
                    </div>

                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700">
                        <h3 class="font-bold text-white text-sm mb-2">Latest Measurement</h3>
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-xs text-gray-400">Weight</p>
                                <p class="text-xl font-bold text-white">6.1 kg</p>
                            </div>
                            <div class="h-8 w-[1px] bg-gray-700"></div>
                            <div>
                                <p class="text-xs text-gray-400">Height</p>
                                <p class="text-xl font-bold text-white">60 cm</p>
                            </div>
                            <div class="h-8 w-[1px] bg-gray-700"></div>
                            <div>
                                <p class="text-xs text-gray-400">Head</p>
                                <p class="text-xl font-bold text-white">40 cm</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- TOAST NOTIFICATION -->
        <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs py-2 px-4 rounded-full shadow-xl opacity-0 transition-opacity duration-300 z-50 border border-gray-700 flex items-center gap-2 pointer-events-none">
            <i class="fas fa-info-circle text-tamm-primary"></i>
            <span id="toast-msg">Notification</span>
        </div>

        <!-- TIMELINE DETAIL MODAL -->
        <div id="timeline-modal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-6" onclick="closeModal()">
            <div class="bg-gray-900 border border-gray-700 rounded-2xl p-6 w-full max-w-sm transform scale-100 transition-all" onclick="event.stopPropagation()">
                <div class="flex items-center gap-3 mb-4">
                    <div id="modal-icon-container" class="w-10 h-10 rounded-full bg-tamm-primary/20 text-tamm-primary flex items-center justify-center">
                        <i id="modal-icon" class="fas fa-check"></i>
                    </div>
                    <h3 id="modal-title" class="text-lg font-bold text-white">Step Title</h3>
                </div>
                <p id="modal-desc" class="text-sm text-gray-300 mb-6 leading-relaxed">Description goes here.</p>
                <button onclick="closeModal()" class="w-full bg-gray-800 hover:bg-gray-700 text-white text-sm font-bold py-3 rounded-xl transition">Close</button>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <nav class="absolute bottom-0 w-full bg-[#121212] border-t border-gray-800 pb-6 pt-3 px-6 flex justify-between items-center z-30">
            <div onclick="navigateTo('screen-home')" id="nav-home" class="nav-item flex flex-col items-center gap-1 cursor-pointer text-tamm-primary transition-colors">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px]">Home</span>
            </div>
            <!-- Services now just scrolls/shows list in home for simplicity in proto, or could be separate screen -->
            <div onclick="navigateTo('screen-home')" class="nav-item flex flex-col items-center gap-1 cursor-pointer text-gray-500 hover:text-white transition-colors">
                <i class="fas fa-th-large text-xl"></i>
                <span class="text-[10px]">Services</span>
            </div>
            <div onclick="navigateTo('screen-wallet')" id="nav-wallet" class="nav-item flex flex-col items-center gap-1 cursor-pointer text-gray-500 hover:text-white transition-colors">
                <i class="fas fa-wallet text-xl"></i>
                <span class="text-[10px]">Wallet</span>
            </div>
            <div onclick="navigateTo('screen-profile')" id="nav-profile" class="nav-item flex flex-col items-center gap-1 cursor-pointer text-gray-500 hover:text-white transition-colors">
                <i class="fas fa-user text-xl"></i>
                <span class="text-[10px]">Profile</span>
            </div>
        </nav>

    </div>

    <script>
        // --- APP STATE ---
        let currentState = {
            stage: 'preconception', 
            userType: 'citizen',
            riskProfile: 'low', 
            activeScreen: 'screen-home',
            childAge: 1
        };

        // --- DATA STORE (Content) ---
        const contentData = {
            preconception: {
                title: "IVF Journey",
                progressIndex: 1,
                isIvf: true,
                hero: { title: "Stimulation Phase", subtitle: "Cycle 1 - Day 4", highlight: "Next Scan: Tomorrow", icon: "fa-vial", color: "text-white", bg: "ivf-gradient" },
                tools: [
                    { title: "My Medications", subtitle: "2 Doses Due", icon: "fa-pills", color: "text-red-400", action: "showToast('Gonal-F (Due Now), Menopur (8 PM)')" },
                    { title: "Genome Results", subtitle: "View Report", icon: "fa-dna", color: "text-blue-400", action: "showToast('Fetching Genome Report...')" },
                    { title: "Link Partner", subtitle: "Connect Profile", icon: "fa-user-friends", color: "text-pink-400", action: "showToast('Invitation sent to partner.')" },
                    { title: "Embryo Scope", subtitle: "Timelapse View", icon: "fa-microscope", color: "text-purple-400", action: "showToast('Timelapse available after fertilization.')" }
                ],
                services: {
                    citizen: [
                        { title: "Assisted Reproduction (IVF)", subtitle: "Manage Cycle", icon: "fa-hand-holding-heart", isHighlight: true },
                        { title: "Preconception Screening", subtitle: "View Reports", icon: "fa-notes-medical", isHighlight: false }
                    ],
                    resident: [
                        { title: "Preconception Package", subtitle: "Book Health Assessment", icon: "fa-user-nurse", isHighlight: false },
                        { title: "Fertility Consultation", subtitle: "IVF & Specialist Services", icon: "fa-calendar-plus", isHighlight: false }
                    ]
                },
                feed: [
                    { title: "Understanding your Protocol", category: "Education", img: "https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&q=80&w=400" },
                    { title: "How to self-inject safely", category: "Guide", img: "https://images.unsplash.com/photo-1584515933487-779824d29309?auto=format&fit=crop&q=80&w=400" }
                ]
            },
            pregnancy: {
                title: "Pregnancy",
                progressIndex: 2,
                isIvf: false,
                hero: { title: "Your baby is the size of a Cherry", subtitle: "Week 9", highlight: "0.9 inches long", icon: "fa-baby", color: "text-pink-400", bg: "bg-pink-900/20" },
                tools: [
                    { title: "Book Appointment", subtitle: "Find Doctor", icon: "fa-user-doctor", color: "text-tamm-primary", action: "showToast('Opening Booking Engine...')" },
                    { title: "Health Records", subtitle: "View Results", icon: "fa-notes-medical", color: "text-purple-400", action: "showToast('Accessing Malaffi Records...')" }
                ],
                services: {
                    citizen: [
                        { title: "Maternity Support (SSA)", subtitle: "Private Sector Financial Aid", icon: "fa-hand-holding-dollar", isHighlight: false },
                        { title: "Antenatal Care Package", subtitle: "Insurance & DOH", icon: "fa-hand-holding-medical", isHighlight: false }
                    ],
                    resident: [
                        { title: "Maternity Leave Attestation", subtitle: "Legal & Labor", icon: "fa-file-signature", isHighlight: false },
                        { title: "Antenatal Package", subtitle: "Check Insurance Coverage", icon: "fa-user-nurse", isHighlight: false }
                    ]
                },
                feed: [
                    { title: "What to eat in the first trimester", category: "Nutrition", img: "https://images.unsplash.com/photo-1490645935967-10de6ba17061?auto=format&fit=crop&q=80&w=400" },
                    { title: "Common symptoms: Week 9", category: "Health", img: "https://images.unsplash.com/photo-1544161515-4ab6ce6db874?auto=format&fit=crop&q=80&w=400" }
                ]
            },
            birth: {
                title: "Birth & Labor",
                progressIndex: 3,
                isIvf: false,
                hero: { title: "Hospital Bag Checklist", subtitle: "Preparation", highlight: "85% Complete", icon: "fa-suitcase", color: "text-blue-400", bg: "bg-blue-900/20" },
                tools: [
                    { title: "Book Appointment", subtitle: "Find Doctor", icon: "fa-user-doctor", color: "text-tamm-primary", action: "showToast('Opening Booking...')" },
                    { title: "Health Records", subtitle: "View Results", icon: "fa-notes-medical", color: "text-purple-400", action: "showToast('Accessing Records...')" }
                ],
                services: {
                    citizen: [
                        { title: "Mabrook Ma Yak", subtitle: "Newborn Bundle (Citizens)", icon: "fa-gift", isHighlight: true },
                        { title: "Birth Notification", subtitle: "Hospital Services", icon: "fa-clipboard-check", isHighlight: false },
                        { title: "Attestation Services", subtitle: "Legal Affairs", icon: "fa-stamp", isHighlight: false }
                    ],
                    resident: [
                        { title: "Issue Birth Certificate", subtitle: "Department of Health", icon: "fa-file-contract", isHighlight: false },
                        { title: "Birth Notification", subtitle: "Hospital Services", icon: "fa-clipboard-check", isHighlight: false }
                    ]
                },
                feed: [
                    { title: "Signs of Labor", category: "Emergency", img: "https://images.unsplash.com/photo-1519823551278-64ac927ac4bb?auto=format&fit=crop&q=80&w=400" },
                    { title: "Pain Management Options", category: "Education", img: "https://images.unsplash.com/photo-1576091160550-217358c7db81?auto=format&fit=crop&q=80&w=400" }
                ]
            },
            postbirth: {
                title: "Post-birth Care",
                progressIndex: 4,
                isIvf: false,
                hero: { title: "Postnatal Check: Day 2", subtitle: "Next: Teleconsultation", highlight: "4-Check Program", icon: "fa-child", color: "text-white", bg: "postnatal-gradient" },
                tools: [
                    { title: "Mental Wellbeing", subtitle: "EPDS Screening", icon: "fa-brain", color: "text-pink-400", action: "showToast('Starting EPDS screening...')" },
                    { title: "Baby Growth", subtitle: "WHO Standards", icon: "fa-ruler-vertical", color: "text-blue-400", action: "openToolsDashboard('Growth Chart')" },
                    { title: "Pelvic Health", subtitle: "Assessment", icon: "fa-female", color: "text-purple-400", action: "showToast('Viewing Recovery Plan...')" },
                    { title: "Lactation Support", subtitle: "Connect Expert", icon: "fa-hand-holding-heart", color: "text-yellow-400", action: "showToast('Connecting to Consultant...')" }
                ],
                services: {
                    citizen: [
                        { title: "Mabrook Ma Yak", subtitle: "Status: Processing", icon: "fa-gift", isHighlight: true },
                        { title: "Add to Family Book", subtitle: "ICP Services", icon: "fa-users", isHighlight: false }
                    ],
                    resident: [
                        { title: "Daman Enrollment", subtitle: "Newborn Insurance (Mandatory)", icon: "fa-shield-heart", isHighlight: false },
                        { title: "Emirates ID Issuance", subtitle: "ICP Services", icon: "fa-id-card", isHighlight: false }
                    ]
                },
                feed: [
                    { title: "Breastfeeding Basics", category: "Feeding", img: "https://images.unsplash.com/photo-1555252333-9f8e92e65df9?auto=format&fit=crop&q=80&w=400" },
                    { title: "Postpartum Recovery", category: "Self Care", img: "https://images.unsplash.com/photo-1515814472071-4d632ff9673d?auto=format&fit=crop&q=80&w=400" }
                ]
            },
            wellchild: {
                title: "Well-Child Care",
                progressIndex: 4,
                isIvf: false,
                hero: { title: "Well-Child Visit: 1 Month", subtitle: "Growth & Development", highlight: "Milestone Check", icon: "fa-baby", color: "text-white", bg: "wellchild-gradient" },
                tools: [
                    { title: "Growth Chart", subtitle: "WHO Standards", icon: "fa-chart-line", color: "text-green-400", action: "openToolsDashboard('Growth Chart')" },
                    { title: "Vaccination", subtitle: "EPI Schedule", icon: "fa-syringe", color: "text-blue-400", action: "showToast('Viewing Immunization Record')" },
                    { title: "Dental Health", subtitle: "Caries Risk", icon: "fa-tooth", color: "text-yellow-400", action: "showToast('Opening Dental Guidance')" },
                    { title: "Screening", subtitle: "Autism / Vision", icon: "fa-eye", color: "text-purple-400", action: "showToast('Opening Screening Tools')" }
                ],
                services: {
                    citizen: [
                        { title: "Child Dental Screening", subtitle: "Book Appointment", icon: "fa-tooth", isHighlight: false },
                        { title: "Nutrition Consultation", subtitle: "Dietary Guidance", icon: "fa-apple-alt", isHighlight: false }
                    ],
                    resident: [
                        { title: "Child Dental Screening", subtitle: "Book Appointment", icon: "fa-tooth", isHighlight: false },
                        { title: "Nutrition Consultation", subtitle: "Dietary Guidance", icon: "fa-apple-alt", isHighlight: false }
                    ]
                },
                feed: [
                    { title: "Tummy Time Guide", category: "Development", img: "https://images.unsplash.com/photo-1519689680058-324335c77eba?auto=format&fit=crop&q=80&w=400" },
                    { title: "Starting Solids", category: "Nutrition", img: "https://images.unsplash.com/photo-1555252333-9f8e92e65df9?auto=format&fit=crop&q=80&w=400" }
                ]
            }
        };

        const milestones = {
            1: [
                { text: "Looks at parent; follows with eyes", category: "Social" },
                { text: "Makes short vowel sounds", category: "Verbal" },
                { text: "Moves arms and legs together", category: "Gross Motor" },
                { text: "Hands are open at rest", category: "Fine Motor" },
                { text: "Hip Check (DDH Screening)", category: "Clinical", icon: "fa-bone", color: "text-red-400" }
            ],
            6: [
                { text: "Babbles (ga, ma, ba)", category: "Verbal" },
                { text: "Rolls over back to stomach", category: "Gross Motor" },
                { text: "Passes toy hand to hand", category: "Fine Motor" },
                { text: "Introduce Solids", category: "Nutrition", icon: "fa-utensils", color: "text-orange-400" },
                { text: "First Tooth Guidance", category: "Dental", icon: "fa-tooth", color: "text-blue-400" }
            ],
            12: [
                { text: "Says 'Mama' or 'Dada' specifically", category: "Verbal" },
                { text: "Stands without support", category: "Gross Motor" },
                { text: "Pincer grasp (thumb & finger)", category: "Fine Motor" },
                { text: "Anemia & Lead Screening", category: "Clinical", icon: "fa-vial", color: "text-red-400" },
                { text: "First Dental Visit", category: "Dental", icon: "fa-tooth", color: "text-blue-400" }
            ],
            18: [
                { text: "Points to show things", category: "Social" },
                { text: "Says at least 6 words", category: "Verbal" },
                { text: "Walks up steps", category: "Gross Motor" },
                { text: "Autism Screening (M-CHAT-R)", category: "Clinical", icon: "fa-brain", color: "text-purple-400" }
            ],
            36: [
                { text: "Uses 3-word sentences", category: "Verbal" },
                { text: "Pedals tricycle", category: "Gross Motor" },
                { text: "Draws a circle", category: "Fine Motor" },
                { text: "Vision & BP Check", category: "Clinical", icon: "fa-eye", color: "text-blue-400" }
            ]
        };

        // --- INTERACTION LOGIC ---

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        }

        function showModal(title, desc, icon = 'fa-info-circle') {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-desc').innerText = desc;
            document.getElementById('modal-icon').className = `fas ${icon}`;
            document.getElementById('timeline-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('timeline-modal').classList.add('hidden');
        }

        function openArticle(title, category, img) {
            document.getElementById('art-title').innerText = title;
            document.getElementById('art-cat').innerText = category;
            document.getElementById('art-img').src = img;
            navigateTo('screen-article');
        }

        function openToolsDashboard(toolName) {
            // Can be expanded to switch content based on toolName
            navigateTo('screen-tools-dashboard');
        }

        function navigateTo(screenId) {
            // Hide all main screens
            const screens = ['screen-home', 'screen-onboarding', 'screen-dashboard', 'screen-service-details', 'screen-newborn-results', 'screen-article', 'screen-wallet', 'screen-profile', 'screen-tools-dashboard'];
            screens.forEach(id => document.getElementById(id).classList.add('hidden'));
            
            document.getElementById(screenId).classList.remove('hidden');
            currentState.activeScreen = screenId;

            // Nav Bar State
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('text-tamm-primary');
                item.classList.add('text-gray-500');
            });

            if (screenId === 'screen-wallet') document.getElementById('nav-wallet').classList.add('text-tamm-primary');
            else if (screenId === 'screen-profile') document.getElementById('nav-profile').classList.add('text-tamm-primary');
            else if (screenId === 'screen-home' || screenId === 'screen-dashboard') document.getElementById('nav-home').classList.add('text-tamm-primary');

            // Back Btn logic
            const backBtn = document.getElementById('backBtn');
            if (screenId === 'screen-home') backBtn.classList.add('hidden');
            else backBtn.classList.remove('hidden');
        }

        function goBack() {
            if (['screen-service-details', 'screen-newborn-results', 'screen-article', 'screen-tools-dashboard'].includes(currentState.activeScreen)) {
                navigateTo('screen-dashboard');
            } else {
                navigateTo('screen-home');
            }
        }

        // --- RENDER LOGIC ---

        function renderTimelines() {
            // IVF Timeline
            const ivfHTML = `
                <div class="step-connector"></div>
                ${createTimelineStep('Stim', 'fa-syringe', 'bg-tamm-ivfPurple', 'text-white', 'Ovarian Stimulation', 'Daily injections to stimulate egg production. Monitoring via Ultrasound.')}
                ${createTimelineStep('Retrieval', 'fa-egg', 'bg-gray-800', 'text-gray-500', 'Egg Retrieval', 'Minor procedure to collect eggs. Sedation used. Partner provides sample same day.')}
                ${createTimelineStep('Fert', 'fa-dna', 'bg-gray-800', 'text-gray-500', 'Fertilization', 'Eggs and sperm combined in lab. Monitoring for fertilization.')}
                ${createTimelineStep('Transfer', 'fa-baby', 'bg-gray-800', 'text-gray-500', 'Embryo Transfer', 'Best embryo transferred to uterus. The 2-week wait begins.')}
            `;
            document.getElementById('ivf-steps').innerHTML = ivfHTML;

            // Postnatal Timeline (Dynamic based on Risk)
            const isHighRisk = currentState.riskProfile === 'high';
            const pnHTML = `
                <div class="step-connector"></div>
                ${createTimelineStep('24hrs', 'fa-check', 'bg-tamm-postnatalPink', 'text-white', '24h Check', 'Full physical exam before hospital discharge. Hearing and CCHD screening initiated.')}
                ${createTimelineStep('Day 3', isHighRisk ? 'fa-home' : 'fa-video', isHighRisk ? 'bg-red-900 text-red-400 border-red-500' : 'bg-gray-800 text-gray-300', isHighRisk ? 'text-red-400' : 'text-gray-300', 'Day 3 Check', isHighRisk ? 'Home Visit by Midwife to check healing and feeding.' : 'Teleconsultation to check on feeding and jaundice.')}
                ${createTimelineStep('Day 10', isHighRisk ? 'fa-home' : 'fa-clinic-medical', 'bg-gray-800', 'text-gray-500', 'Day 10 Check', 'Weight check and cord care assessment.')}
                ${createTimelineStep('Week 6', 'fa-user-check', 'bg-gray-800', 'text-gray-500', 'Week 6 Check', 'Final postnatal check. Pelvic health and contraception discussion.')}
            `;
            document.getElementById('postnatal-steps').innerHTML = pnHTML;
        }

        function createTimelineStep(label, icon, bgClass, textClass, modalTitle, modalDesc) {
            // Simplified rendering helper
            return `
            <div class="relative z-10 flex flex-col items-center gap-1 cursor-pointer transition transform hover:scale-110" onclick="showModal('${modalTitle}', '${modalDesc}', '${icon}')">
                <div class="w-8 h-8 rounded-full ${bgClass} flex items-center justify-center border-2 border-[#121212] shadow-lg">
                    <i class="fas ${icon} text-xs"></i>
                </div>
                <span class="text-[9px] ${textClass} font-bold">${label}</span>
            </div>`;
        }

        function setStage(stageKey) {
            currentState.stage = stageKey;
            
            // UI Resets
            document.getElementById('risk-toggle-container').classList.add('hidden');
            document.getElementById('child-age-selector').classList.add('hidden');
            
            if(stageKey === 'postbirth') {
                currentState.riskProfile = 'low';
                document.getElementById('risk-toggle-container').classList.remove('hidden');
                toggleRisk('low'); 
            } else if (stageKey === 'wellchild') {
                document.getElementById('child-age-selector').classList.remove('hidden');
                setChildAge(1); 
            }
            
            updateDashboard();
            navigateTo('screen-dashboard');
        }

        function toggleUserType(type) {
            currentState.userType = type;
            const btnCit = document.getElementById('toggle-citizen');
            const btnRes = document.getElementById('toggle-resident');
            
            if(type === 'citizen') {
                btnCit.classList.add('bg-gray-700', 'text-white', 'shadow');
                btnCit.classList.remove('text-gray-400');
                btnRes.classList.remove('bg-gray-700', 'text-white', 'shadow');
                btnRes.classList.add('text-gray-400');
            } else {
                btnRes.classList.add('bg-gray-700', 'text-white', 'shadow');
                btnRes.classList.remove('text-gray-400');
                btnCit.classList.remove('bg-gray-700', 'text-white', 'shadow');
                btnCit.classList.add('text-gray-400');
            }
            updateDashboard();
        }

        function toggleRisk(risk) {
            currentState.riskProfile = risk;
            const btnStd = document.getElementById('risk-std');
            const btnHigh = document.getElementById('risk-high');
            
            if(risk === 'low') {
                btnStd.className = "px-3 py-1 rounded-md bg-green-900/30 text-green-400 border border-green-900 transition-all shadow-sm";
                btnHigh.className = "px-3 py-1 rounded-md text-gray-500 hover:text-red-400 transition-all";
            } else {
                btnHigh.className = "px-3 py-1 rounded-md bg-red-900/30 text-red-400 border border-red-900 transition-all shadow-sm";
                btnStd.className = "px-3 py-1 rounded-md text-gray-500 hover:text-green-400 transition-all";
            }
            updateDashboard(); // Re-render timeline with new risk
        }

        function setChildAge(age) {
            currentState.childAge = age;
            const buttons = document.querySelectorAll('#child-age-selector button');
            buttons.forEach(btn => {
                if(btn.innerText.includes(age + ' ')) {
                    btn.className = "age-btn active px-3 py-1 rounded-full bg-tamm-wellChildBlue text-white text-xs border border-blue-500 whitespace-nowrap shadow-lg scale-105 transition-all";
                } else {
                    btn.className = "age-btn px-3 py-1 rounded-full bg-gray-800 text-gray-400 text-xs border border-gray-700 whitespace-nowrap hover:bg-gray-700 transition-all";
                }
            });
            if(currentState.stage === 'wellchild') {
                contentData['wellchild'].hero.title = `Well-Child Visit: ${age} ${age >= 12 ? (age == 36 ? 'Years' : 'Months') : 'Month'}`;
                updateDashboard();
                renderMilestones(age);
            }
        }

        function renderMilestones(age) {
            const list = document.getElementById('milestone-list');
            list.innerHTML = '';
            const ageMilestones = milestones[age] || milestones[1];
            ageMilestones.forEach(m => {
                let iconClass = m.icon ? `fas ${m.icon} ${m.color}` : 'fas fa-check-circle text-green-500';
                const div = document.createElement('div');
                div.className = "flex items-start gap-3 p-2 rounded-lg hover:bg-gray-800/50 transition cursor-default";
                div.innerHTML = `
                    <div class="mt-1"><i class="${iconClass}"></i></div>
                    <div>
                        <p class="text-xs font-bold text-white">${m.category}</p>
                        <p class="text-[10px] text-gray-400">${m.text}</p>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function openService(title, subtitle, icon) {
            document.getElementById('sd-title').innerText = title;
            document.getElementById('sd-subtitle').innerText = subtitle + ". This service is provided through the Tamm ecosystem.";
            document.getElementById('sd-icon').className = `fas ${icon} text-4xl text-white`;
            navigateTo('screen-service-details');
        }

        function updateDashboard() {
            const data = contentData[currentState.stage];
            
            document.getElementById('dashboard-title').innerText = data.title;
            for(let i=1; i<=4; i++) {
                const bar = document.getElementById(`prog-${i}`);
                if(i <= data.progressIndex) {
                    bar.classList.remove('bg-gray-700');
                    bar.classList.add('bg-tamm-primary');
                } else {
                    bar.classList.add('bg-gray-700');
                    bar.classList.remove('bg-tamm-primary');
                }
            }

            // Visibilty
            const ivfTimeline = document.getElementById('ivf-timeline');
            const careTeam = document.getElementById('care-team');
            const communityCard = document.getElementById('community-card');
            const notifDot = document.getElementById('notif-dot');
            const postnatalTimeline = document.getElementById('postnatal-timeline');
            const newbornScreeningCard = document.getElementById('newborn-screening-card');
            const milestoneTracker = document.getElementById('milestone-tracker');
            
            ivfTimeline.classList.add('hidden');
            careTeam.classList.add('hidden');
            communityCard.classList.add('hidden');
            notifDot.classList.add('hidden');
            postnatalTimeline.classList.add('hidden');
            newbornScreeningCard.classList.add('hidden');
            milestoneTracker.classList.add('hidden');

            if (data.isIvf && currentState.userType === 'citizen') {
                ivfTimeline.classList.remove('hidden');
                careTeam.classList.remove('hidden');
                communityCard.classList.remove('hidden');
                notifDot.classList.remove('hidden');
                document.getElementById('clinician-role').innerText = 'Specialist';
                document.getElementById('clinician-name').innerText = 'Dr. Ahmed';
            }

            if (currentState.stage === 'postbirth') {
                postnatalTimeline.classList.remove('hidden');
                careTeam.classList.remove('hidden');
                newbornScreeningCard.classList.remove('hidden');
                const riskLabel = document.getElementById('risk-label');
                if (currentState.riskProfile === 'low') {
                    riskLabel.innerText = 'Standard Pathway';
                    riskLabel.className = 'text-[9px] bg-green-900/50 text-green-400 px-2 py-0.5 rounded border border-green-800';
                    document.getElementById('clinician-role').innerText = 'Pediatrician';
                    document.getElementById('clinician-name').innerText = 'Dr. Sarah';
                } else {
                    riskLabel.innerText = 'High Risk Pathway';
                    riskLabel.className = 'text-[9px] bg-red-900/50 text-red-400 px-2 py-0.5 rounded border border-red-800';
                    document.getElementById('clinician-role').innerText = 'Home Facilitator';
                    document.getElementById('clinician-name').innerText = 'Nurse Layla';
                }
            }

            if (currentState.stage === 'wellchild') {
                milestoneTracker.classList.remove('hidden');
                careTeam.classList.remove('hidden');
                document.getElementById('clinician-role').innerText = 'Pediatrician';
                document.getElementById('clinician-name').innerText = 'Dr. Sarah';
                renderMilestones(currentState.childAge);
            }

            // Timelines
            renderTimelines();

            // Hero
            let heroBgClass = data.hero.bg.startsWith('ivf') ? 'bg-gradient-to-r from-[#4c1d95] to-[#8B5CF6]' : 
                              data.hero.bg.startsWith('postnatal') ? 'bg-gradient-to-r from-[#be185d] to-[#EC4899]' :
                              data.hero.bg.startsWith('wellchild') ? 'bg-gradient-to-r from-[#1e3a8a] to-[#3B82F6]' :
                              'bg-gradient-to-r from-gray-900 to-gray-800';
            
            const heroHTML = `
                <div class="absolute inset-0 ${heroBgClass}"></div>
                <div class="absolute right-0 top-0 w-32 h-32 bg-white opacity-10 rounded-bl-full blur-xl"></div>
                <div class="relative z-10">
                    <p class="text-sm text-gray-200 mb-1 opacity-80">${data.hero.subtitle}</p>
                    <h2 class="text-2xl font-bold text-white mb-2 w-3/4">${data.hero.title}</h2>
                    <div class="inline-block px-3 py-1 bg-black/30 rounded-lg backdrop-blur text-sm font-medium text-white border border-white/10">
                        ${data.hero.highlight}
                    </div>
                </div>
                <div class="absolute right-4 bottom-4 w-16 h-16 bg-white/10 rounded-full flex items-center justify-center border border-white/10 backdrop-blur-sm">
                    <i class="fas ${data.hero.icon} text-2xl ${data.hero.color}"></i>
                </div>
            `;
            document.getElementById('hero-card').innerHTML = heroHTML;

            // Tools
            const toolsContainer = document.getElementById('digital-tools');
            toolsContainer.innerHTML = '';
            let currentTools = [];
            if ((currentState.stage === 'preconception' && data.isIvf && currentState.userType === 'citizen') || 
                currentState.stage === 'postbirth' || 
                currentState.stage === 'wellchild') {
                currentTools = data.tools;
            } else {
                currentTools = data.tools.slice(0, 2);
            }
            
            currentTools.forEach(tool => {
                const toolBtn = document.createElement('button');
                toolBtn.className = "bg-gray-800/50 p-4 rounded-2xl flex flex-col items-center justify-center border border-gray-700 hover:bg-gray-800 transition active:scale-95";
                toolBtn.onclick = function() { eval(tool.action); };
                toolBtn.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gray-700/50 flex items-center justify-center mb-2">
                        <i class="fas ${tool.icon} ${tool.color}"></i>
                    </div>
                    <span class="text-xs font-bold text-white">${tool.title}</span>
                    <span class="text-[9px] text-gray-500 mt-1">${tool.subtitle}</span>
                `;
                toolsContainer.appendChild(toolBtn);
            });

            // Services
            const servicesList = document.getElementById('services-list');
            servicesList.innerHTML = '';
            let currentServices = [...(data.services[currentState.userType] || [])];

            if (currentState.stage === 'postbirth') {
                if (currentState.riskProfile === 'high') {
                    currentServices.unshift({ title: "Postnatal Home Visit", subtitle: "Scheduled: Tomorrow 10 AM", icon: "fa-user-nurse", isHighlight: true });
                } else {
                    currentServices.unshift({ title: "Postnatal Teleconsultation", subtitle: "Book for Day 3", icon: "fa-video", isHighlight: false });
                }
            }
            
            if (currentServices.length > 0) {
                currentServices.forEach(service => {
                    const serviceDiv = document.createElement('div');
                    serviceDiv.onclick = function() { openService(service.title, service.subtitle, service.icon); };
                    if (service.isHighlight) {
                        serviceDiv.className = "p-[1px] rounded-2xl bg-gradient-to-r from-[#996515] via-[#D4AF37] to-[#F4C430] cursor-pointer hover:shadow-lg transition-shadow duration-300 active:scale-[0.98]"; 
                        serviceDiv.innerHTML = `
                            <div class="bg-gray-900 rounded-2xl p-4 flex items-center justify-between relative overflow-hidden group">
                                <div class="absolute right-0 top-0 w-20 h-20 bg-[#D4AF37] opacity-10 rounded-bl-full blur-xl group-hover:opacity-20 transition"></div>
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-[#D4AF37]/20 text-[#D4AF37] flex items-center justify-center mr-3 border border-[#D4AF37]/30">
                                        <i class="fas ${service.icon}"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-white text-sm flex items-center gap-2">
                                            ${service.title}
                                            <span class="text-[8px] bg-[#D4AF37] text-black px-1.5 py-0.5 rounded font-bold">Priority</span>
                                        </h4>
                                        <p class="text-xs text-gray-400">${service.subtitle}</p>
                                    </div>
                                </div>
                                <div class="bg-[#D4AF37] text-black w-8 h-8 flex items-center justify-center rounded-full"><i class="fas fa-arrow-right text-xs"></i></div>
                            </div>
                        `;
                    } else {
                        serviceDiv.className = "bg-gray-800/40 border border-gray-700 p-3 rounded-2xl flex items-center justify-between hover:bg-gray-800 transition cursor-pointer active:scale-[0.98]";
                        serviceDiv.innerHTML = `
                            <div class="flex items-center">
                                <div class="w-9 h-9 rounded-full bg-gray-700/50 text-gray-400 flex items-center justify-center mr-3"><i class="fas ${service.icon}"></i></div>
                                <div><h4 class="font-medium text-white text-sm">${service.title}</h4><p class="text-xs text-gray-500">${service.subtitle}</p></div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
                        `;
                    }
                    servicesList.appendChild(serviceDiv);
                });
            } else {
                servicesList.innerHTML = `<p class="text-xs text-gray-500 text-center italic">No specific services for this stage.</p>`;
            }

            // Feed
            const feedContainer = document.getElementById('content-feed');
            feedContainer.innerHTML = ''; 
            data.feed.forEach(item => {
                const card = document.createElement('div');
                card.className = "min-w-[200px] bg-gray-900 rounded-xl overflow-hidden border border-gray-800 flex-shrink-0 cursor-pointer active:scale-95 transition";
                card.onclick = function() { openArticle(item.title, item.category, item.img); };
                card.innerHTML = `
                    <div class="h-28 bg-gray-800 relative">
                        <img src="${item.img}" class="w-full h-full object-cover opacity-80">
                        <div class="absolute top-2 left-2 px-2 py-1 bg-black/60 backdrop-blur rounded text-[10px] text-white">${item.category}</div>
                    </div>
                    <div class="p-3"><h4 class="text-sm font-semibold text-white leading-tight">${item.title}</h4></div>
                `;
                feedContainer.appendChild(card);
            });
        }
        
        // Initial Render
        updateDashboard();
    </script>
</body>
</html>
